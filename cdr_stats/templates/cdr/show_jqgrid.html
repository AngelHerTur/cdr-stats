{% extends "cdr/master.html" %}
{% load cdr_extras %}
{% block extra_head %}

<script type="text/javascript">
$(function () {
    $.getJSON("{% url grid_config %}", function(data){
        $("#mygrid")
            .jqGrid(data)
            .navGrid('#pager', 
                {add: false, edit: false, del: false, view: true},
        {}, // edit options
        {}, // add options
        {}, // del options 
        { multipleSearch:true, closeOnEscape:true }, // search options 
        { jqModal:true, closeOnEscape:true} // view options
        ).filterToolbar({stringResult: true,searchOnEnter : false});
    });
});

</script>

{% endblock %}

{% block content %}
<form method="GET" name="search_cdr" action="." enctype="multipart/form-data">
<table width=70% border=1 cellspacing=0 cellpadding=0 align=center>
    <tr>
        <td>{{ form.selection_of_month_day }}</td>
        <td>{{ form.from_chk_month }}&nbsp;{{ form.from_month_year_1.label }}&nbsp;
            {{ form.from_month_year_1 }}
            <br/>
            {{ form.from_chk_day }}&nbsp;{{ form.from_day.label }}&nbsp;{{ form.from_day_1.label }}&nbsp;
            {{ form.from_day }}&nbsp;{{ form.from_month_year_2 }}
        </td>
        <td>&nbsp;</td>
        <td>{{ form.to_chk_month }}&nbsp;{{ form.to_month_year_1.label }}&nbsp;
            &nbsp;{{ form.to_month_year_1 }}
            <br/>
            {{ form.to_chk_day }}
            {{ form.to_day.label }}&nbsp;&nbsp;{{ form.to_day }}&nbsp;{{ form.to_month_year_2 }}
        </td>
    </tr>
    <tr>
        <td>&nbsp;</td>
        <td>{{form.result.label}}&nbsp;{{form.result|removetags:"ul li"|safe}}</td>
        <td>&nbsp;</td>
    </tr>
    <tr><td align=center colspan=4><input type="submit" value="Search" />&nbsp;<input type="reset" value="Clear"></td></tr>
</table>
</form>



<p>&nbsp;</p>
<div id="cdr-container" class='tabcontainer'>


    <div id='general-info'>
                
        <table id="mygrid"></table>
		<div id="pager"></div>


    </div>

</div>
<p>&nbsp;</p>
<table width=50% border=1 cellspacing=0 cellpadding=0 align=center>
<tr>
    <td align=left>Total</td>
</tr>
</table>
<table width=50% border=1 cellspacing=0 cellpadding=1 align=center>
<tr>
    <td align=center>&nbsp;</td>
    <td align=center clospan="4">Asterisk Minutes</td>
</tr>
<tr>
    <td align=right>Date</td>
    <td align=center>Duration</td>
    <td align=center>Graphic</td>
    <td align=center>Calls</td>
    <td align=center><acronym title="Average Connection Time">ACT</acronym></td>
</tr>
{% for td in total_data %}
<tr>
    <td align=right>{{td.calldate}}</td>
    <td align=center>{{td.duration__sum|conv_min}}</td>
    <td align=left><img src="{{MEDIA_URL}}/images/spacer.png" width="{{td.duration__sum|cal_width:max_duration}}" style="vertical-align:center;" height="10"/></td>
    <td align=center>{{td.calldate__count}}</td>
    <td align=center>{{td.duration__avg|conv_min}}</td>
</tr>
{% endfor %}
<tr>
    <td align=right>Total</td>
    <td align=center>{{total_duration|conv_min}}</td>
    <td></td>
    <td align=center>{{total_calls}}</td>
    <td align=center>{{total_avg_duration|conv_min}}</td>
</tr>
</table>

<p>&nbsp;</p>
<table width=50% border=0 cellspacing=0 cellpadding=0 align=center>
<tr>
    <td align=center><a href="/export_csv/" target="_blank" >Export CSV file</a></td>
</tr>
</table>

{% endblock %}
