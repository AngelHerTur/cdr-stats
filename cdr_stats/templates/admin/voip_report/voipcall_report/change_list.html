{% extends "admin/change_list.html" %}
{% load adminmedia admin_list i18n %}
{% load common_tags %}

{% block content %}
  <div id="content-main">
    
    {% if cl.formset.errors %}
        <p class="errornote">
        {% blocktrans count cl.formset.errors|length as counter %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktrans %}
        </p>
        {{ cl.formset.non_form_errors }}
    {% endif %}

    {% block custom-search %}
    <form method="POST" action="." enctype="multipart/form-data">{% csrf_token %}
    <table class="actions">
        <caption>{% trans "Search Option" %}</caption>
        {% for field in form %}
            <tr>
                <th>
                    <label class="control-label" for="{{ field.auto_id }}">
                        {{ field.label }}
                    </label>
                </th>
                <td>{{ field }}
                    {% if field.errors %}
                        <span>{{ field.errors|removetags:"ul li"|safe }}</span>
                    {% endif %}
                    <span>{{ field.help_text }} </span>
                </td>
            </tr>
        {% endfor %}
        <tr>
            <td>&nbsp;</td>
            <td><input type="submit" value="{% trans "Search" %}" class="l-1" />&nbsp;
			<input type="reset" class="j-2" name="reset" value="{% trans "Reset" %}"><td>
        </tr>
    </table>
    </form>
    {% endblock %}

    {% block object-tools %}
        <ul class="object-tools">
          <li><a href="export_voip_report/" class="addlink">{% trans "Export Report" %}</a></li>
          <li><a href="import_voip_report/" class="addlink">{% trans "Import Report" %}</a></li>
          {% if has_add_permission %}
          <li>
            <a href="add/{% if is_popup %}?_popup=1{% endif %}" class="addlink">
              {% blocktrans with cl.opts.verbose_name as name %}Add {{ name }}{% endblocktrans %}
            </a>
          </li>
          {% endif %}
          <li>
              <a href="rebilling/" class="addlink">
                  {% trans "Rebilling" %}
              </a>
          </li>
        </ul>
    {% endblock %}

    <div class="module{% if cl.has_filters %} filtered{% endif %}" id="changelist">
      {% block search %}{% search_form cl %}{% endblock %}
      {% block date_hierarchy %}{% date_hierarchy cl %}{% endblock %}

      {% block filters %}
        {% if cl.has_filters %}
          <div id="changelist-filter">
            <h2>{% trans 'Filter' %}</h2>
            {% for spec in cl.filter_specs %}{% admin_list_filter cl spec %}{% endfor %}
          </div>
        {% endif %}
      {% endblock %}
      
      <form id="changelist-form" action="" method="post"{% if cl.formset.is_multipart %} enctype="multipart/form-data"{% endif %}>{% csrf_token %}
      {% if cl.formset %}
        {{ cl.formset.management_form }}
      {% endif %}      
      {% block result_list %}
          {% if action_form and actions_on_top and cl.full_result_count %}{% admin_actions %}{% endif %}
          {% result_list cl %}
          {% if action_form and actions_on_bottom and cl.full_result_count %}{% admin_actions %}{% endif %}
      {% endblock %}
      {% block pagination %}{% pagination cl %}{% endblock %}
      </form>
    </div>

    {% block extra_data %}

        <table  class="module" align=center>
            <caption>{% trans "Call Detail Report"  %}</caption>
            <thead>
                <tr>
                    <th scope="col">{% trans "Date"  %}</th>
                    <th scope="col">{% trans "Duration"  %}</th>
                    <th scope="col">{% trans "Graphic"  %}</th>
                    <th scope="col">{% trans "Calls"  %}</th>
                    <th scope="col">{% trans "Carrier Cost" %}</th>
                    <th scope="col">{% trans "Retail Cost" %}</th>
                    <th scope="col">{% trans "Profit" %}</th>
                    <th scope="col"><acronym title="{% trans "Average Connection Time" %}">{% trans "ACT"  %}</acronym></th>
                </tr>
            </thead>
            <tbody>
                {% for td in total_data %}
                <tr class="{% cycle 'row1' 'row2' %}">
                    <td>{{ td.updated_date }}</td>
                    <td>{{ td.sessiontime_real__sum|conv_min }}</td>
                    <td>{% if max_duration > 0 %}
                            <img src="{{ STATIC_URL }}cdr-stats/images/spacer.png" width="{{ td.sessiontime_real__sum|cal_width:max_duration }}" style="vertical-align:center;" height="10"/>
                        {% endif %}
                    </td>
                    <td>{{ td.updated_date__count }}</td>
                    <td>{{ td.carrier_cost__sum }}</td>
                    <td>{{ td.retail_cost__sum }}</td>
                    <td>{{ td.retail_cost__sum|subtract:td.carrier_cost__sum }}</td>
                    <td>{{ td.sessiontime_real__avg|conv_min }}</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td>{% trans "Total"  %}</td>
                    <td>{{ total_duration|conv_min }}</td>
                    <td></td>
                    <td>{{ total_calls }}</td>
                    <td>{{ total_carrier_cost }}</td>
                    <td>{{ total_retail_cost }}</td>
                    <td>{{ total_profit }}</td>
                    <td>{{ total_avg_duration|conv_min }}</td>
                </tr>
            </tfoot>
        </table>

    {% endblock %}

  </div>
{% endblock %}
