{% extends "frontend/master.html" %}
{% load i18n country_dialcode_tags common_tags nvd3_tags crispy_forms_tags %}
{% load cache %}

{% block extra_head %}
    <script type="text/javascript">
        $(function () {
            $('a[data-toggle="tab"]').on('click', function (e) {
                if (e.target.hash == '#tabs-2') {
                    {% load_chart final_duration_charttype final_duration_chartdata final_duration_chartcontainer final_duration_extra %}
                }
            });
        });
    </script>
    {{ form.media }}
{% endblock %}

{% block content_header %}
    <h1>{% trans "country report"|capfirst %}<small></small></h1>
{% endblock %}

{% block content %}
<div id="form_collapse" class="collapse">
    {% crispy form form.helper %}
</div>
{% include "frontend/common_search_toggle_button.html" %}

<p>&nbsp;</p>

<div class="tabbable">
    <div class="tab-content">

        <div class="row">
            <div class="col-md-12 col-xs-12 col-sm-12">
                <div class="graph_header">
                    <h2>{% trans "country call statistics"|title %}</h2>
                </div>
                {% load_chart final_charttype final_chartdata final_chartcontainer final_extra %}
                {% include_container final_chartcontainer 400 '100%' %}
            </div>
        </div>

    </div>
</div>

TODO: Loops on list of metrics here,

<div class="row">
    <div class="col-md-6">
        <h2 align="center">{% trans "calls by country"|title %}</h2>
        <hr/>
        {% load_chart country_charttype country_chartdata country_chartcontainer country_extra %}
        {% include_container country_chartcontainer 450 500 %}
    </div>
</div>

<div class="row">
    <div class="col-md-4 col-md-offset-1">
        <div>
            <h4 class="text-left">{% trans "top"|title %} {{ NUM_COUNTRY }} {% trans "calls by country"|title %}</h4>
            <table class="table table-bordered">
                {% for country_data in country_analytic %}
                    <tr>
                        <td>
                            {% if country_data.3 %}
                                {% cache 1800 hcountry_flag country_data.3 %}
                                    <img src="{{ STATIC_URL }}cdr-stats/{{ country_data.3|iso_flag }}" class="elemtooltip" title="{{ country_data.3|country_name|title }}">
                                {% endcache %}
                            {% else %}
                                <img src="{{ STATIC_URL }}cdr-stats/icons/world.png" class="elemtooltip" title="{% trans "World" %}">
                            {% endif %}
                        </td>
                        <td>
                            {% if country_data.0 %}
                                {{ country_data.0 }}
                            {% else %}
                                {% trans "world"|title  %}
                            {% endif %}
                        </td>
                        <td>{{ country_data.1 }} {% trans "calls"|capfirst %}</td>
                    </tr>
                {% endfor %}
                <tr>
                    <td></td>
                    <td>{% trans "total"|capfirst %}</td>
                    <td>{{ total_metric }} {% trans "calls"|capfirst %}</td>
                </tr>
            </table>
        </div>
    </div>

</div>

{% endblock %}
