{% extends "frontend/master.html" %}
{% load i18n country_dialcode_tags common_tags nvd3_tags crispy_forms_tags %}
{% load cache %}

{% block extra_head %}
    <script type="text/javascript">
        $(function () {
            $("#accordion").accordion({ autoHeight: false,  clearStyle: true });

            $('a[data-toggle="tab"]').on('click', function (e) {
                if (e.target.hash == '#tabs-2') {
                    {% load_chart final_duration_charttype final_duration_chartdata final_duration_chartcontainer final_duration_extra %}
                }
            });
        });
    </script>
    {{ form.media }}
{% endblock %}


{% block content %}
<div id="form_collapse" class="collapse">
    {% crispy form form.helper %}
</div>
{% include "frontend/common_search_toggle_button.html" %}

<p>&nbsp;</p>

<div class="tabbable">
    <ul class="nav nav-tabs">
        <li {% if action == "tabs-1" %}class="active"{% endif %}><a href="#tabs-1" data-toggle="tab">{% trans "country call"|title %}</a></li>
        <li {% if action == "tabs-2" %}class="active"{% endif %}><a href="#tabs-2" data-toggle="tab">{% trans "country duration"|title %}</a></li>
    </ul>
    <div class="tab-content">
        <div id="tabs-1" class="tab-pane {% if action == "tabs-1" or action == "" %}active{% endif %}">
            <div class="row">
                <div class="col-md-12 col-xs-12 col-sm-12">
                    <div class="graph_header">
                        <h2>{% trans "country call statistics"|title %}</h2>
                    </div>
                    {% load_chart final_call_charttype final_call_chartdata final_call_chartcontainer final_call_extra %}
                    {% include_container final_call_chartcontainer 400 '100%' %}
                </div>
            </div>

        </div>
        <div id="tabs-2" class="tab-pane {% if action == "tabs-2" or action == "" %}active{% endif %}">
            <div class="row">
                <div class="col-md-12 col-xs-12 col-sm-12">
                    <div class="graph_header">
                        <h2>{% trans "country duration statistics"|title %}</h2>
                    </div>
                    {% include_container final_duration_chartcontainer 400 '100%' %}
                </div>
            </div>

        </div>
    </div>
</div>

<br/><br/>

<div class="row">
    <div class="col-md-6 welldashboard">
        <h2 align="center">{% trans "calls by country"|title %}</h2>
        <hr/>
        {% load_chart country_call_charttype country_call_chartdata country_call_chartcontainer country_call_extra %}
        {% include_container country_call_chartcontainer 400 500 %}
        <br/>
        <div class="col-md-6">
            <h3 class="text-left">{% trans "top"|title %} {{ NUM_COUNTRY }} {% trans "calls by country"|title %}</h3>
            <table>
                <tbody>
                {% for country_data in country_analytic %}
                    <tr>
                        <td class="td-dashboard">
                            {% if country_data.3 %}
                                {% cache 1800 hcountry_flag country_data.3 %}
                                    <img src="{{ STATIC_URL }}cdr-stats/{{ country_data.3|iso_flag }}" class="elemtooltip" title="{{ country_data.3|country_name|title }}">
                                {% endcache %}
                            {% else %}
                                <img src="{{ STATIC_URL }}cdr-stats/icons/world.png" class="elemtooltip" title="{% trans "World" %}">
                            {% endif %}
                        </td>
                        <td class="td-dashboard" width="100">
                            {% if country_data.0 %}
                                {{ country_data.0 }}
                            {% else %}
                                {% trans "world"|title  %}
                            {% endif %}
                        </td>
                        <td width="100">{{ country_data.1 }} {% trans "calls"|capfirst %}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <hr style="width:400px;"/>
            <table>
                <tbody>
                <tr>
                    <td class="td-dashboard"></td>
                    <td class="td-dashboard" width="100">{% trans "total"|capfirst %}</td>
                    <td width="100">{{ total_calls }} {% trans "calls"|capfirst %}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-md-6 welldashboard">
        <h2 align="center">{% trans "duration by country"|title %}</h2>
        <hr/>
        {% load_chart country_call_charttype country_duration_chartdata country_duration_chartcontainer country_duration_extra %}
        {% include_container country_duration_chartcontainer 400 500 %}
        <br/>
        <div class="col-md-6">
            <h3 class="text-left">{% trans "top"|title %} {{ NUM_COUNTRY }} {% trans "duration by country"|title %}</h3>
            <table>
                <tbody>
                {% for country_data in country_analytic %}
                    <tr>
                        <td class="td-dashboard">
                            {% if country_data.3 %}
                                {% cache 1800 hcountry_flag country_data.3 %}
                                    <img src="{{ STATIC_URL }}cdr-stats/{{ country_data.3|iso_flag }}" class="elemtooltip" title="{{ country_data.3|country_name|title }}">
                                {% endcache %}
                            {% else %}
                                <img src="{{ STATIC_URL }}cdr-stats/icons/world.png" class="elemtooltip" title="{% trans "World" %}">
                            {% endif %}
                        </td>
                        <td class="td-dashboard" width="100">
                            {% if country_data.0 %}
                                {{ country_data.0 }}
                            {% else %}
                                {% trans "world"|title  %}
                            {% endif %}
                        </td>
                        <td>{{ country_data.2|conv_min }} {% trans "minutes" %}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <hr style="width:400px;"/>
            <table>
                <tbody>
                <tr>
                    <td class="td-dashboard"></td>
                    <td class="td-dashboard" width="100">{% trans "total"|capfirst %}</td>
                    <td>{{ total_duration|conv_min }} {% trans "minutes" %}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}
